import os

import pytest

from httpx import {{ http_client_import }}
{% for client in clients -%}
from {{ child_client_import }}.{{ service_module }}.{{ client.api_module }}_client import {{ client.api_client_class }}
{% endfor %}


class {{ service_class }}:
    def __init__(self, api_client: {{ http_client_class }}) -> None:
        self.api_client = api_client
{% for client in clients %}        self.{{ client.attribute_name }} = {{ client.api_client_class }}(api_client=api_client)
{% endfor %}

@pytest.fixture
{% if async_mode %}async {% endif %}def {{ service_fixture_name }}_client() -> {{ http_client_class }}:
    return {{ http_client_class }}(base_url=os.getenv("{{ service_module | upper }}_BASE_URL"))


@pytest.fixture
{% if async_mode %}async {% endif %}def {{ service_fixture_name }}({{ service_fixture_name }}_client: {{ http_client_class }}) -> {{ service_class }}:
    return {{ service_class }}(api_client={{ service_fixture_name }}_client)
